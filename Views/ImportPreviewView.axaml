<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:QuadroApp.ViewModels"
        xmlns:imp="clr-namespace:QuadroApp.Model.Import"
        x:Class="QuadroApp.Views.ImportPreviewView"
        x:DataType="vm:ImportPreviewViewModel"
        Width="1200"
        Height="760"
        Background="#F5F5F5"
        Title="Importvoorbeeld">

  <Window.Styles>
    <Style Selector="TextBlock">
      <Setter Property="Foreground" Value="Black"/>
    </Style>
  </Window.Styles>

  <Grid RowDefinitions="Auto,Auto,*,Auto" ColumnDefinitions="2.2*,1*" Margin="16">
    <Border Grid.Row="0" Grid.ColumnSpan="2" Background="#444A50" CornerRadius="10" Padding="14">
      <DockPanel LastChildFill="False">
        <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" VerticalAlignment="Center" Spacing="10">
          <Ellipse Width="28" Height="28" Fill="#F5C242"/>
          <TextBlock Text="QUADRO" Foreground="White" FontWeight="Bold" FontSize="18"/>
          <TextBlock Text="IMPORT" Foreground="#D7D7D7" FontSize="13"/>
        </StackPanel>
        <TextBlock DockPanel.Dock="Right" Text="{Binding EntityName}" Foreground="White" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
      </DockPanel>
    </Border>

    <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" Spacing="8" Margin="0,12,0,8">
      <TextBox Width="420" Watermark="Kies Excel-bestand..." Text="{Binding SelectedFilePath, Mode=TwoWay}"/>
      <Button Content="Bestand kiezen" Command="{Binding ChooseFileCommand}" Background="#F5C242" Foreground="#222" FontWeight="Bold"/>
      <Button Content="Voorbeeld laden" Command="{Binding DryRunCommand}" Background="#F5C242" Foreground="#222" FontWeight="Bold"/>
      <Button Content="Import uitvoeren" Command="{Binding CommitImportCommand}" Background="#F5C242" Foreground="#222" FontWeight="Bold"/>
      <Button Content="Lopende actie stoppen" Command="{Binding CancelOperationCommand}" IsEnabled="{Binding IsBusy}"/>
    </StackPanel>

    <Border Grid.Row="2" Grid.Column="0" Margin="0,0,10,0" BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="10" Background="White" Padding="10">
      <StackPanel Spacing="10">
        <TextBlock Text="Overzicht" FontSize="18" FontWeight="Bold"/>
        <TextBlock Text="{Binding SummaryText}"/>
        <TextBlock Text="{Binding WarningText}" IsVisible="{Binding HasWarnings}"/>
        <TextBlock Text="{Binding ProgressText}" FontStyle="Italic"/>

        <ListBox ItemsSource="{Binding Rows}" SelectedItem="{Binding SelectedRow, Mode=TwoWay}">
          <ListBox.ItemTemplate>
            <DataTemplate x:DataType="vm:PreviewRowItem">
              <Border BorderBrush="#E1E1E1" BorderThickness="1" CornerRadius="8" Padding="8" Margin="0,0,0,8" Background="#FFFFFF">
                <StackPanel Spacing="4">
                  <DockPanel>
                    <TextBlock DockPanel.Dock="Left" Text="{Binding Title}" FontWeight="Bold"/>
                    <Border DockPanel.Dock="Right" Padding="6,2" CornerRadius="5" Background="#FFF3BF">
                      <TextBlock Text="{Binding StateLabel}" FontWeight="SemiBold"/>
                    </Border>
                  </DockPanel>

                  <ItemsControl ItemsSource="{Binding Values}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="6">
                          <TextBlock Text="{Binding Key, StringFormat={}{0}: }" FontWeight="SemiBold"/>
                          <TextBlock Text="{Binding Value}" TextWrapping="Wrap"/>
                        </StackPanel>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </StackPanel>
    </Border>

    <StackPanel Grid.Row="2" Grid.Column="1" Spacing="10">
      <Border BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="10" Background="White" Padding="10">
        <StackPanel>
          <TextBlock Text="Rijproblemen" FontSize="16" FontWeight="Bold" Margin="0,0,0,8"/>
          <ListBox ItemsSource="{Binding SelectedRowIssues}">
            <ListBox.ItemTemplate>
              <DataTemplate x:DataType="imp:ImportRowIssue">
                <Border Padding="6" Margin="0,0,0,6" CornerRadius="6" Background="#F7F7F7">
                  <StackPanel>
                    <TextBlock Text="{Binding Severity}" FontWeight="Bold"/>
                    <TextBlock Text="{Binding ColumnName}"/>
                    <TextBlock Text="{Binding Message}" TextWrapping="Wrap"/>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
        </StackPanel>
      </Border>

      <Border BorderBrush="#D0D0D0" BorderThickness="1" CornerRadius="10" Background="White" Padding="10">
        <StackPanel>
          <TextBlock Text="Waarden van geselecteerde rij" FontSize="16" FontWeight="Bold" Margin="0,0,0,8"/>
          <ItemsControl ItemsSource="{Binding SelectedRowValues}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,0,0,4">
                  <TextBlock Text="{Binding Key, StringFormat={}{0}: }" FontWeight="SemiBold"/>
                  <TextBlock Text="{Binding Value}" TextWrapping="Wrap"/>
                </StackPanel>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>
      </Border>
    </StackPanel>

    <StackPanel Grid.Row="3" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8" Margin="0,12,0,0">
      <Button Content="Annuleren" Command="{Binding CancelCommand}"/>
    </StackPanel>
  </Grid>
</Window>
