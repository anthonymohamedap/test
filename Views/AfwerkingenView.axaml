<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:QuadroApp.ViewModels"
    xmlns:m="clr-namespace:QuadroApp.Model.DB"
    x:Class="QuadroApp.Views.AfwerkingenView"
    x:DataType="vm:AfwerkingenViewModel"
    Background="#F5F5F5">

	<Grid RowDefinitions="Auto,*,Auto">

		<!-- â–‘â–‘ HEADER â–‘â–‘ -->
		<Border Grid.ColumnSpan="2" Background="#444A50" Height="70">
			<DockPanel LastChildFill="False" Margin="20,0">

				<StackPanel DockPanel.Dock="Left" Orientation="Horizontal" VerticalAlignment="Center" Spacing="10">
					<Ellipse Width="35" Height="35" Fill="#F5C242"/>
					<TextBlock Text="QUADRO" Foreground="White" FontWeight="Bold" FontSize="20" VerticalAlignment="Center"/>
					<TextBlock Text="LIJSTENBEHEER" Foreground="#CCC" FontSize="13" Margin="5,0,0,0" VerticalAlignment="Center"/>
				</StackPanel>

				<Button Content="â¬…ï¸ Terug"
						Command="{Binding GaTerugCommand}"
						DockPanel.Dock="Right"
						VerticalAlignment="Top"
						HorizontalAlignment="Right"
						Margin="0,10,10,0"
						Background="#F5C242"
						Foreground="#222"
						FontWeight="Bold"
						CornerRadius="8"
						Padding="10,5"
						Width="100"
						Height="32"/>
			</DockPanel>
		</Border>

		<!-- â–‘â–‘ MAIN CONTENT â–‘â–‘ -->
		<ScrollViewer Grid.Row="1" Margin="0,10,0,10" VerticalScrollBarVisibility="Auto">
			<StackPanel Margin="20" Spacing="15">

				<TextBlock Text="ðŸ§© Afwerkingen"
						   FontSize="24"
						   FontWeight="Bold"
						   Foreground="#222"
						   Margin="0,0,0,5"/>

				<!-- Toolbar -->
				<StackPanel Orientation="Horizontal" Spacing="10" Margin="0,0,0,15">
					<Button Content="ðŸ”„ Verversen"  Command="{Binding RefreshAsyncCommand}" Classes="MainBtn"/>
					<Button Content="âž• Nieuw"       Command="{Binding NewAsyncCommand}"      Classes="MainBtn"/>
					<Button Content="ðŸ’¾ Opslaan"     Command="{Binding SaveAsyncCommand}"     Classes="MainBtn"/>
					<Button Content="ðŸ—‘ï¸ Verwijderen" Command="{Binding DeleteAsyncCommand}"   Classes="MainBtn"/>
					<Button Content="ðŸ“¥ Excel import" Command="{Binding ImportExcelCommand}"  Classes="MainBtn"/>
				</StackPanel>

				<!-- Twee kolommen -->
				<Grid ColumnDefinitions="360,*" ColumnSpacing="14">

					<!-- â•â•â•â•â•â•â•â•â•â•â• LINKERKOLOM â•â•â•â•â•â•â•â•â•â•â• -->
					<Border Classes="card" Background="White" BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="12" Padding="16">
						<StackPanel Spacing="14">

							<StackPanel Spacing="8">
								<TextBlock Text="Groep" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>

								<ComboBox ItemsSource="{Binding Groepen}"
										  SelectedItem="{Binding SelectedGroep}"
										  MinWidth="140">
									<ComboBox.ItemTemplate>
										<DataTemplate x:DataType="m:AfwerkingsGroep">
											<TextBlock Text="{Binding Code} - {Binding Naam}"/>
										</DataTemplate>
									</ComboBox.ItemTemplate>
								</ComboBox>

								<TextBlock Text="Zoek optie" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>
								<TextBox Watermark="Zoek op code of naamâ€¦"
										 Text="{Binding Zoekterm, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
										 Margin="0,0,0,2"/>

								<TextBlock Text="{Binding AantalOptiesText}" Foreground="#6B7280" FontStyle="Italic" FontSize="12"/>
							</StackPanel>

							<!-- Lijst -->
							<Border Background="#F7F7F9" CornerRadius="10" Padding="8" Margin="0,4,0,0">
								<ListBox ItemsSource="{Binding FilteredOpties}"
										 SelectedItem="{Binding SelectedOptie, Mode=TwoWay}"
										 ScrollViewer.VerticalScrollBarVisibility="Auto"
										 BorderThickness="0"
										 Background="Transparent">

									<ListBox.Styles>
										<Style Selector="ListBoxItem">
											<Setter Property="CornerRadius" Value="8"/>
											<Setter Property="Margin" Value="0,4"/>
											<Setter Property="Padding" Value="10"/>
											<Setter Property="MinHeight" Value="44"/>
											<Setter Property="Background" Value="#FFFFFF"/>
											<Setter Property="BorderBrush" Value="#E5E7EB"/>
											<Setter Property="BorderThickness" Value="1"/>
											<Setter Property="HorizontalContentAlignment" Value="Stretch"/>
										</Style>
										<Style Selector="ListBoxItem:pointerover">
											<Setter Property="Background" Value="#EEF2FF"/>
											<Setter Property="BorderBrush" Value="#CBD5E1"/>
										</Style>
										<Style Selector="ListBoxItem:selected">
											<Setter Property="Background" Value="#DBEAFE"/>
											<Setter Property="BorderBrush" Value="#93C5FD"/>
										</Style>
									</ListBox.Styles>

									<ListBox.ItemTemplate>
										<DataTemplate x:DataType="m:AfwerkingsOptie">
											<Grid ColumnDefinitions="Auto,*,Auto"
												  ColumnSpacing="12"
												  VerticalAlignment="Center"
												  HorizontalAlignment="Stretch">

												<Border Background="#E5E7EB" CornerRadius="6" Padding="6,3" VerticalAlignment="Center">
													<TextBlock Text="{Binding Volgnummer}" FontWeight="SemiBold" Foreground="#111827"/>
												</Border>

												<StackPanel Grid.Column="1" Orientation="Vertical" Spacing="2">
													<TextBlock Text="{Binding Naam}"
															   FontWeight="SemiBold"
															   Foreground="#111827"
															   TextWrapping="NoWrap"
															   TextTrimming="CharacterEllipsis"/>
													<TextBlock Text="{Binding AfwerkingsGroep.Naam}"
															   Foreground="#6B7280"
															   FontSize="11"
															   TextWrapping="NoWrap"
															   TextTrimming="CharacterEllipsis"/>
												</StackPanel>

												<!-- Leverancier code null-safe -->
												<Border Grid.Column="2" Background="#F3F4F6" CornerRadius="6" Padding="6,3" VerticalAlignment="Center">
													<Border Grid.Column="2"
			Background="#F3F4F6"
			CornerRadius="6"
			Padding="6,3"
			VerticalAlignment="Center">

														<TextBlock Foreground="#374151"
																   FontSize="12"
																   FontWeight="SemiBold">

															<TextBlock.Text>
																<MultiBinding StringFormat="{}{0}">
																	<Binding Path="Leverancier.Code" TargetNullValue="â€”"/>
																</MultiBinding>
															</TextBlock.Text>

														</TextBlock>
													</Border>
												</Border>
											</Grid>
										</DataTemplate>
									</ListBox.ItemTemplate>
								</ListBox>
							</Border>

							<TextBlock Text="{Binding Status}" Foreground="#4B5563"/>
							<TextBlock Text="{Binding Foutmelding}" Foreground="Red" FontWeight="Bold" TextWrapping="Wrap"/>
						</StackPanel>
					</Border>

					<!-- â•â•â•â•â•â•â•â•â•â•â• RECHTERKOLOM (details) â•â•â•â•â•â•â•â•â•â•â• -->
					<Border Grid.Column="1" Classes="card" Background="White" BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="12" Padding="16">
						<ScrollViewer VerticalScrollBarVisibility="Auto">
							<StackPanel Spacing="20">

								<!-- Info als niets gekozen -->
								<StackPanel Spacing="8" IsVisible="{Binding HeeftGeenSelectie}">
									<TextBlock Text="Selecteer een afwerkingsoptie links om de details te bekijken."
											   Foreground="#6B7280"/>
								</StackPanel>

								<!-- Details -->
								<StackPanel Spacing="16"
											IsEnabled="{Binding HeeftSelectie}"
											IsVisible="{Binding HeeftSelectie}">

									<!-- Basis -->
									<StackPanel>
										<TextBlock Text="Basis" FontSize="18" FontWeight="SemiBold" Foreground="#222" Margin="0,6,0,10"/>

										<Grid ColumnDefinitions="200,*" RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="8" ColumnSpacing="10">

											<TextBlock Grid.Row="0" Grid.Column="0" Text="Naam" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>
											<TextBox Grid.Row="0" Grid.Column="1"
													 Text="{Binding SelectedOptie.Naam, Mode=TwoWay, TargetNullValue='', FallbackValue=''}"/>

											<TextBlock Grid.Row="1"
			   Grid.Column="0"
			   Text="Volgnummer"
			   Foreground="#555"
			   FontSize="12"
			   Margin="0,6,0,4"/>

											<TextBox Grid.Row="1"
													 Grid.Column="1"
													 MaxLength="1"
													 Text="{Binding VolgnummerText, Mode=TwoWay}"
													 HorizontalContentAlignment="Center"
													 FontWeight="SemiBold"/>

											<TextBlock Grid.Row="2" Grid.Column="0" Text="Leverancier" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>

											<!-- ComboBox: ItemsSource blijft stabiel door VM-fix (Clear/Add),
                           plus Text is apart gebonden op LeverancierZoekterm -->
											<StackPanel Grid.Row="2" Grid.Column="1" Spacing="6">

												<!-- Huidige leverancier duidelijk zichtbaar -->
												<Border Background="#EEF2FF"
														CornerRadius="6"
														Padding="6">

													<TextBlock FontWeight="SemiBold"
															   Foreground="#1E40AF"
															   Text="{Binding SelectedLeverancier.Code, TargetNullValue='Geen leverancier geselecteerd'}"/>
												</Border>

												<!-- Zoekbox -->
												<TextBox Watermark="Zoek leverancier..."
														 Text="{Binding LeverancierZoekterm, UpdateSourceTrigger=PropertyChanged}"/>

												<!-- Selectie -->
												<ComboBox ItemsSource="{Binding GefilterdeLeveranciers}"
														  SelectedItem="{Binding SelectedLeverancier, Mode=TwoWay}"
														  MaxDropDownHeight="250">

													<ComboBox.ItemTemplate>
														<DataTemplate x:DataType="m:Leverancier">
															<TextBlock>
																<Run Text="{Binding Code}" />
																<Run Text=" â€” " />
																<Run Text="{Binding Naam}" />
															</TextBlock>
														</DataTemplate>
													</ComboBox.ItemTemplate>

												</ComboBox>

											</StackPanel>

											<TextBlock Grid.Row="3" Grid.Column="0" Text="Dealeroptie" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>
											<ToggleSwitch Grid.Row="3" Grid.Column="1"
														  IsChecked="{Binding IsDealerOptie}"
														  IsEnabled="False"/>
										</Grid>
									</StackPanel>

									<Separator/>

									<!-- Prijs & werk -->
									<StackPanel>
										<TextBlock Text="Prijs &amp; werk" FontSize="18" FontWeight="SemiBold" Foreground="#222" Margin="0,6,0,10"/>

										<Grid ColumnDefinitions="200,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="8" ColumnSpacing="10">

											<TextBlock Grid.Row="0" Grid.Column="0" Text="Kostprijs per mÂ² (â‚¬)" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>
											<NumericUpDown Grid.Row="0" Grid.Column="1"
														   Value="{Binding SelectedOptie.KostprijsPerM2, Mode=TwoWay, TargetNullValue=0, FallbackValue=0}"
														   Increment="0.5" FormatString="0.00"/>

											<TextBlock Grid.Row="1" Grid.Column="0" Text="Winstmarge (factor)" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>
											<NumericUpDown Grid.Row="1" Grid.Column="1"
														   Value="{Binding SelectedOptie.WinstMarge, Mode=TwoWay, TargetNullValue=0, FallbackValue=0}"
														   Increment="0.05" FormatString="0.000"/>

											<TextBlock Grid.Row="2" Grid.Column="0" Text="Afval (%)" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>
											<NumericUpDown Grid.Row="2" Grid.Column="1"
														   Value="{Binding SelectedOptie.AfvalPercentage, Mode=TwoWay, TargetNullValue=0, FallbackValue=0}"
														   Increment="0.5" FormatString="0.00"/>

											<TextBlock Grid.Row="3" Grid.Column="0" Text="Vaste kost (â‚¬)" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>
											<NumericUpDown Grid.Row="3" Grid.Column="1"
														   Value="{Binding SelectedOptie.VasteKost, Mode=TwoWay, TargetNullValue=0, FallbackValue=0}"
														   Increment="0.5" FormatString="0.00"/>

											<TextBlock Grid.Row="4" Grid.Column="0" Text="Werkminuten" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>
											<NumericUpDown Grid.Row="4" Grid.Column="1"
														   Value="{Binding SelectedOptie.WerkMinuten, Mode=TwoWay, TargetNullValue=0, FallbackValue=0}"
														   Increment="5" Minimum="0" Maximum="1440"/>
										</Grid>
									</StackPanel>

									<Separator/>

									<!-- Preview -->
									<StackPanel>
										<TextBlock Text="Prijsberekening (preview)" FontSize="18" FontWeight="SemiBold" Foreground="#222" Margin="0,6,0,10"/>

										<Grid ColumnDefinitions="200,*" RowDefinitions="Auto,Auto,Auto" RowSpacing="8" ColumnSpacing="10">
											<TextBlock Grid.Row="0" Grid.Column="0" Text="Breedte (cm)" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>
											<NumericUpDown Grid.Row="0" Grid.Column="1"
														   Value="{Binding PreviewBreedteCm, Mode=TwoWay, TargetNullValue=30, FallbackValue=30}"
														   Minimum="1" Maximum="300" Increment="1" FormatString="0"/>

											<TextBlock Grid.Row="1" Grid.Column="0" Text="Hoogte (cm)" Foreground="#555" FontSize="12" Margin="0,6,0,4"/>
											<NumericUpDown Grid.Row="1" Grid.Column="1"
														   Value="{Binding PreviewHoogteCm, Mode=TwoWay, TargetNullValue=40, FallbackValue=40}"
														   Minimum="1" Maximum="300" Increment="1" FormatString="0"/>

											<TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
													   FontWeight="SemiBold"
													   Foreground="#0A7C3E"
													   Text="{Binding PreviewPrijsText}"/>
										</Grid>
									</StackPanel>

								</StackPanel>
							</StackPanel>
						</ScrollViewer>
					</Border>
				</Grid>
			</StackPanel>
		</ScrollViewer>

		<!-- â–‘â–‘ FOOTER â–‘â–‘ -->
		<Border Grid.Row="2" Background="#F5F5F5" Padding="10">
			<TextBlock Text="{Binding FilteredOpties.Count, StringFormat='Aantal opties: {0}'}"
					   HorizontalAlignment="Center"
					   Foreground="#666"/>
		</Border>

	</Grid>

	<!-- â–‘â–‘ STIJLEN â–‘â–‘ -->
	<UserControl.Styles>
		<Style Selector="Button.MainBtn">
			<Setter Property="Background" Value="#444A50"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="FontSize" Value="15"/>
			<Setter Property="Padding" Value="10,5"/>
		</Style>
		<Style Selector="Button.MainBtn:pointerover">
			<Setter Property="Background" Value="#F5C242"/>
			<Setter Property="Foreground" Value="#222"/>
		</Style>
	</UserControl.Styles>

</UserControl>