<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:QuadroApp.ViewModels"
    xmlns:m="using:QuadroApp.Model.DB"
    x:Class="QuadroApp.Views.OffertesLijstView"
    x:DataType="vm:OffertesLijstViewModel"
    Background="#F5F5F5">

	<Grid RowDefinitions="Auto,*,Auto">

		<Border Grid.ColumnSpan="2" Background="#444A50" Height="70">
			<DockPanel LastChildFill="False" Margin="20,0">

				<StackPanel DockPanel.Dock="Left"
							Orientation="Horizontal"
							VerticalAlignment="Center"
							Spacing="10">
					<Ellipse Width="35" Height="35" Fill="#F5C242"/>
					<TextBlock Text="QUADRO"
							   Foreground="White"
							   FontWeight="Bold"
							   FontSize="20"
							   VerticalAlignment="Center"/>
					<TextBlock Text="OFFERTES"
							   Foreground="#CCC"
							   FontSize="13"
							   Margin="5,0,0,0"
							   VerticalAlignment="Center"/>
				</StackPanel>

				<Button Content="â¬…ï¸ Terug"
						Command="{Binding GaTerugCommand}"
						DockPanel.Dock="Right"
						VerticalAlignment="Top"
						HorizontalAlignment="Right"
						Margin="0,10,10,0"
						Background="#F5C242"
						Foreground="#222"
						FontWeight="Bold"
						CornerRadius="8"
						Padding="10,5"
						Width="100"
						Height="32"/>
			</DockPanel>
		</Border>

		<StackPanel Grid.Row="1" Margin="20" Spacing="14">

			<TextBlock Text="ðŸ“„ Offertes"
					   FontSize="24"
					   FontWeight="Bold"
					   Foreground="#222"
					   Margin="0,0,0,4"/>

			<StackPanel Orientation="Horizontal"
						Spacing="10"
						Margin="0,0,0,10">
				<TextBox Width="260"
						 Watermark="Zoek offerteâ€¦"
						 Text="{Binding Zoekterm, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

				<Button Content="âž• Nieuw"
						Command="{Binding NewCommand}"
						Classes="MainBtn"/>
				<Button Content="ðŸ—‘ï¸ Verwijderen"
						Command="{Binding DeleteCommand}"
						Classes="MainBtn"/>
				
			</StackPanel>

			<Grid ColumnDefinitions="0.7*,2*,1.1*,1.1*,1.1*,0.9*,1.1*,1.2*,Auto"
				  Margin="6,0,6,6">
				<TextBlock Text="Nr."          Grid.Column="0" FontWeight="Bold" Foreground="#000"/>
				<TextBlock Text="Klant"        Grid.Column="1" FontWeight="Bold" Foreground="#000"/>
				<TextBlock Text="Datum"        Grid.Column="2" FontWeight="Bold" Foreground="#000"/>
				<TextBlock Text="Gepland"      Grid.Column="3" FontWeight="Bold" Foreground="#000"/>
				<TextBlock Text="Deadline"     Grid.Column="4" FontWeight="Bold" Foreground="#000"/>
				<TextBlock Text="Tijd (min)"   Grid.Column="5" FontWeight="Bold" Foreground="#000"/>
				<TextBlock Text="Status"       Grid.Column="6" FontWeight="Bold" Foreground="#000"/>
				<TextBlock Text="Totaal incl." Grid.Column="7" FontWeight="Bold" Foreground="#000" HorizontalAlignment="Right"/>
				<TextBlock Text="Actie"        Grid.Column="8" FontWeight="Bold" Foreground="#000" HorizontalAlignment="Right"/>
			</Grid>

			<Border BorderBrush="#DDD"
					BorderThickness="1"
					CornerRadius="8"
					Background="White">

				<ListBox x:Name="OffertesList"
						 ItemsSource="{Binding FilteredOffertes}"
						 SelectedItem="{Binding SelectedOfferte, Mode=TwoWay}"
						 BorderThickness="0"
						 Background="Transparent"
						 ScrollViewer.VerticalScrollBarVisibility="Auto"
						 DoubleTapped="OffertesList_DoubleTapped">

					<ListBox.Styles>
						<Style Selector="ListBoxItem">
							<Setter Property="CornerRadius" Value="6"/>
							<Setter Property="Margin" Value="0,0,0,6"/>
							<Setter Property="Padding" Value="8"/>
							<Setter Property="Background" Value="Transparent"/>
						</Style>
						<Style Selector="ListBoxItem:pointerover">
							<Setter Property="Background" Value="#FFF7DA"/>
						</Style>
						<Style Selector="ListBoxItem:selected">
							<Setter Property="Background" Value="#FFF3BF"/>
							<Setter Property="BorderBrush" Value="#F5C242"/>
							<Setter Property="BorderThickness" Value="1"/>
						</Style>
					</ListBox.Styles>

					<ListBox.ItemTemplate>
						<DataTemplate x:DataType="m:Offerte">
							<Grid ColumnDefinitions="0.7*,2*,1.1*,1.1*,1.1*,0.9*,1.1*,1.2*,Auto"
								  VerticalAlignment="Center"
								  ColumnSpacing="8">

								<TextBlock Grid.Column="0"
										   Text="{Binding Id}"
										   Foreground="#222"
										   FontSize="15"
										   FontWeight="Bold"
										   VerticalAlignment="Center"
										   TextTrimming="CharacterEllipsis"/>

								<StackPanel Grid.Column="1">
									<TextBlock Foreground="#222"
											   FontSize="15"
											   FontWeight="Bold"
											   TextTrimming="CharacterEllipsis">
										<TextBlock.Text>
											<MultiBinding StringFormat="{}{0} {1}">
												<Binding Path="Klant.Voornaam"/>
												<Binding Path="Klant.Achternaam"/>
											</MultiBinding>
										</TextBlock.Text>
									</TextBlock>
									<TextBlock Foreground="#666"
											   FontSize="13"
											   TextTrimming="CharacterEllipsis"
											   Text="{Binding Klant.Email}"/>
								</StackPanel>

								<TextBlock Grid.Column="2"
										   Text="{Binding Datum, StringFormat='{}{0:dd/MM/yyyy}'}"
										   Foreground="#333"
										   VerticalAlignment="Center"
										   TextTrimming="CharacterEllipsis"/>

								<TextBlock Grid.Column="3"
										   Text="{Binding GeplandeDatum, StringFormat='{}{0:dd/MM}'}"
										   Foreground="#333"
										   VerticalAlignment="Center"
										   TextTrimming="CharacterEllipsis"/>

								<TextBlock Grid.Column="4"
										   Text="{Binding DeadlineDatum, StringFormat='{}{0:dd/MM}'}"
										   Foreground="#333"
										   VerticalAlignment="Center"
										   TextTrimming="CharacterEllipsis"/>

								<TextBlock Grid.Column="5"
										   Text="{Binding GeschatteMinuten}"
										   Foreground="#333"
										   VerticalAlignment="Center"
										   TextTrimming="CharacterEllipsis"/>

								<TextBlock Grid.Column="6"
										   Text="{Binding Status}"
										   Foreground="#333"
										   VerticalAlignment="Center"
										   TextTrimming="CharacterEllipsis"/>

								<TextBlock Grid.Column="7"
										   Text="{Binding TotaalInclBtw, StringFormat='â‚¬ {0:0.00}'}"
										   Foreground="#333"
										   VerticalAlignment="Center"
										   HorizontalAlignment="Right"
										   TextTrimming="CharacterEllipsis"/>

								<StackPanel Grid.Column="8"
											Orientation="Horizontal"
											Spacing="6"
											HorizontalAlignment="Right">
									<!-- âœ… FIX #2: Command via ElementName naar ListBox/DataContext -->
									<Button Content="ðŸ—‘ï¸"
											Width="32" Height="30"
											Background="#AA3333" Foreground="White"
											Command="{Binding DataContext.DeleteCommand, ElementName=OffertesList}"
											CommandParameter="{Binding}"/>
								</StackPanel>

							</Grid>
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>
			</Border>

			<TextBlock Text="{Binding FilteredOffertes.Count, StringFormat='Aantal offertes: {0}'}"
					   HorizontalAlignment="Center"
					   Foreground="#666"
					   Margin="0,6,0,0"/>
		</StackPanel>

		<Border Grid.Row="2" Background="#F5F5F5" Padding="8">
			<TextBlock Text=" " />
		</Border>

	</Grid>

	<UserControl.Styles>
		<Style Selector="Button.MainBtn">
			<Setter Property="Background" Value="#444A50"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="CornerRadius" Value="8"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="FontSize" Value="15"/>
			<Setter Property="Padding" Value="10,5"/>
		</Style>
		<Style Selector="Button.MainBtn:pointerover">
			<Setter Property="Background" Value="#F5C242"/>
			<Setter Property="Foreground" Value="#222"/>
		</Style>
	</UserControl.Styles>

</UserControl>
